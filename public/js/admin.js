// Generated by CoffeeScript 1.6.3
(function() {
  var Admin, Enquiries, Settings;

  Admin = (function() {
    function Admin() {
      console.log("Admin javascripts loaded");
      if ($("#enquiries").length) {
        new Enquiries;
      }
      if ($("#settings").length) {
        new Settings;
      }
    }

    return Admin;

  })();

  $(function() {
    if ($("#admin").length) {
      return new Admin;
    }
  });

  Enquiries = (function() {
    function Enquiries() {
      this.allCheckboxes = $("#enquiries input:checkbox");
      this.checkboxSelectAll = $("#select-all");
      this.buttonDelete = $("#delete-button");
      this.buttonMarkAsRead = $("#mark-read-button");
      this.buttonMarkAsUnread = $("#mark-unread-button");
      this.enquiryReplyForm = $("#enquiry-reply-form");
      this.bindEvents();
    }

    Enquiries.prototype.bindEvents = function() {
      var _this = this;
      this.checkboxSelectAll.click(function() {
        return _this.selectAllClicked();
      });
      this.buttonDelete.click(function() {
        return _this.deleteSelected();
      });
      this.buttonMarkAsRead.click(function() {
        return _this.markSelected(true);
      });
      this.buttonMarkAsUnread.click(function() {
        return _this.markSelected(false);
      });
      this.allCheckboxes.click(function() {
        return _this.checkboxClicked();
      });
      return this.enquiryReplyForm.submit(function(e) {
        return _this.sendReply(e);
      });
    };

    Enquiries.prototype.selectAllClicked = function() {
      if (this.checkboxSelectAll.prop('checked')) {
        return this.selectAllCheckboxes();
      } else {
        return this.unselectAllCheckboxes();
      }
    };

    Enquiries.prototype.checkboxClicked = function() {
      if (this.allCheckboxes.not(':checked').length) {
        return this.checkboxSelectAll.prop("checked", false);
      } else {
        return this.checkboxSelectAll.prop("checked", true);
      }
    };

    Enquiries.prototype.selectAllCheckboxes = function() {
      return this.allCheckboxes.prop('checked', true);
    };

    Enquiries.prototype.unselectAllCheckboxes = function() {
      return this.allCheckboxes.prop('checked', false);
    };

    Enquiries.prototype.deleteSelected = function() {
      var _this = this;
      return this.checkedCheckboxes().each(function(idx, checkbox) {
        var id;
        id = $(checkbox).data('id');
        $(checkbox).closest('tr').fadeOut(500);
        return $.ajax({
          type: "delete",
          url: "/admin/enquiries/" + id,
          success: function() {
            return console.log("Deleted!");
          },
          error: function() {
            return console.log("Problem :(");
          }
        });
      });
    };

    Enquiries.prototype.markSelected = function(viewed) {
      var _this = this;
      return this.checkedCheckboxes().each(function(idx, checkbox) {
        var id;
        id = $(checkbox).data('id');
        if (viewed) {
          $(checkbox).closest('tr').removeClass('info');
        } else {
          $(checkbox).closest('tr').addClass('info');
        }
        _this.unselectAllCheckboxes();
        _this.checkboxSelectAll.prop('checked', false);
        return $.ajax({
          type: "put",
          url: "/admin/enquiries/" + id,
          data: {
            viewed: viewed
          },
          success: function(data) {
            return console.log("Success!");
          },
          error: function() {
            return console.log("There was a problem updating the record(s)");
          }
        });
      });
    };

    Enquiries.prototype.checkedCheckboxes = function() {
      return $("input[name='enquiry[]']:checked");
    };

    Enquiries.prototype.sendReply = function(e) {
      var data,
        _this = this;
      this.showSending();
      data = this.enquiryReplyForm.serialize();
      $.ajax({
        type: "POST",
        url: "/admin/enquiries/reply",
        data: data,
        success: function(data) {
          return _this.showSendSuccess();
        }
      });
      return e.preventDefault();
    };

    Enquiries.prototype.showSending = function() {
      var btn;
      btn = this.enquiryReplyForm.find('input:submit');
      return btn.attr('disabled', 'disabled').val("Sending");
    };

    Enquiries.prototype.showSendSuccess = function() {
      var btn;
      btn = this.enquiryReplyForm.find('input:submit');
      return btn.addClass('btn-success').val("Sent!");
    };

    return Enquiries;

  })();

  Settings = (function() {
    function Settings() {
      this.form = $("#edit-setting-form");
      this.bindEvents();
    }

    Settings.prototype.bindEvents = function() {
      var _this = this;
      return this.form.submit(function(e) {
        return _this.submitForm(e);
      });
    };

    Settings.prototype.submitForm = function(e) {
      var btn;
      console.log(this.form.attr('action'));
      btn = this.form.find('button[type=submit]');
      btn.find('i').show();
      $.ajax({
        type: "put",
        url: this.form.attr('action'),
        data: this.form.serialize(),
        success: function() {
          return btn.find('i').delay(300).hide(function() {
            return btn.html("Updated!").addClass('btn-success disabled');
          });
        }
      });
      return e.preventDefault();
    };

    return Settings;

  })();

}).call(this);
