// Generated by CoffeeScript 1.6.3
(function() {
  var Admin, Enquiries;

  Admin = (function() {
    function Admin() {
      console.log("Admin javascripts loaded");
      if ($("#enquiries").length) {
        new Enquiries;
      }
    }

    return Admin;

  })();

  $(function() {
    if ($("#admin").length) {
      return new Admin;
    }
  });

  Enquiries = (function() {
    function Enquiries() {
      this.allCheckboxes = $("#enquiries input:checkbox");
      this.checkboxSelectAll = $("#select-all");
      this.buttonDelete = $("#delete-button");
      this.buttonMarkAsRead = $("#mark-read-button");
      this.buttonMarkAsUnread = $("#mark-unread-button");
      this.bindEvents();
    }

    Enquiries.prototype.bindEvents = function() {
      var _this = this;
      this.checkboxSelectAll.click(function() {
        return _this.selectAllClicked();
      });
      this.buttonDelete.click(function() {
        return _this.deleteSelected();
      });
      this.buttonMarkAsRead.click(function() {
        return _this.markSelected(true);
      });
      this.buttonMarkAsUnread.click(function() {
        return _this.markSelected(false);
      });
      return this.allCheckboxes.click(function() {
        return _this.checkboxClicked();
      });
    };

    Enquiries.prototype.selectAllClicked = function() {
      if (this.checkboxSelectAll.prop('checked')) {
        return this.selectAllCheckboxes();
      } else {
        return this.unselectAllCheckboxes();
      }
    };

    Enquiries.prototype.checkboxClicked = function() {
      if (this.allCheckboxes.not(':checked').length) {
        return this.checkboxSelectAll.prop("checked", false);
      } else {
        return this.checkboxSelectAll.prop("checked", true);
      }
    };

    Enquiries.prototype.selectAllCheckboxes = function() {
      return this.allCheckboxes.each(function() {
        return $(this).prop('checked', true);
      });
    };

    Enquiries.prototype.unselectAllCheckboxes = function() {
      return this.allCheckboxes.each(function() {
        return $(this).prop('checked', false);
      });
    };

    Enquiries.prototype.deleteSelected = function() {
      return this.checkedCheckboxes().each(function() {
        return $(this).closest('tr').remove();
      });
    };

    Enquiries.prototype.markSelected = function(enquiryIsRead) {
      var _this = this;
      return this.checkedCheckboxes().each(function(idx, chk) {
        var viewed;
        if (enquiryIsRead) {
          $(chk).closest('tr').removeClass('info');
          viewed = enquiryIsRead;
        } else {
          $(chk).closest('tr').addClass('info');
          viewed = !enquiryIsRead;
        }
        $(chk).prop('checked', false);
        _this.checkboxSelectAll.prop('checked', false);
        return _this.makeRequest('PUT', {
          id: $(chk).val(),
          viewed: viewed
        });
      });
    };

    Enquiries.prototype.checkedCheckboxes = function() {
      return $("input[name='enquiry[]']:checked");
    };

    Enquiries.prototype.makeRequest = function(method, data) {
      return $.ajax({
        url: "/admin/enquiries/" + data.id,
        type: method,
        data: data,
        success: function() {
          return console.log("Success");
        },
        error: function() {
          return console.log("Problem");
        }
      });
    };

    Enquiries.prototype.serialize = function() {};

    return Enquiries;

  })();

}).call(this);
